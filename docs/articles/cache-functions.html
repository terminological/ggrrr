<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Caching functions â€¢ ggrrr</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Caching functions">
<meta property="og:description" content="ggrrr">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">ggrrr</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.0.0.9008</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../articles/ggrrr.html">Get started</a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/cache-functions.html">Caching functions</a>
    </li>
    <li>
      <a href="../articles/figure-functions.html">Figure functions</a>
    </li>
    <li>
      <a href="../articles/font-functions.html">Font functions</a>
    </li>
    <li>
      <a href="../articles/other-table-formats.html">Other table formats</a>
    </li>
    <li>
      <a href="../articles/table-functions.html">Table functions</a>
    </li>
  </ul>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right"></ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><script src="cache-functions_files/accessible-code-block-0.0.1/empty-anchor.js"></script><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Caching functions</h1>
            
      
      
      <div class="hidden name"><code>cache-functions.Rmd</code></div>

    </div>

    
    
<p><code>ggrrr</code> supports a super simple passthrough caching layer. This assumes calculations are deterministic, and with a stated set of inputs will compute and cache the result.</p>
<p>Setting the caching location should be transparent. The default directory is the user cache directory, but in an analysis project a specific cache directory may be preferred</p>
<div class="sourceCode" id="cb1"><pre class="downlit">
<span class="co"># Setting a cache in an analysis project might be in a sub-directory of the project</span>
<span class="co"># options("cache.dir"=here::here("cache"))</span>

<span class="co"># If in a package you might be using a package specific cache</span>
<span class="co"># options("cache.dir"=rappdirs::user_cache_dir("my-package"))</span>

<span class="co"># for our purposes a temporary directory is OK, but caching to a tempdir will only persist as long as the session is active.</span>
<span class="fu"><a href="https://rdrr.io/r/base/options.html">options</a></span><span class="op">(</span><span class="st">"cache.dir"</span><span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/tempfile.html">tempdir</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span></pre></div>
<div id="caching-an-item" class="section level2">
<h2 class="hasAnchor">
<a href="#caching-an-item" class="anchor"></a>Caching an item</h2>
<p>The item caches is the result of running an expression with in the current environment. We manually specify which items in the environment may affect the outcome. The cache key is a combination of the hash of the expression and the input data.</p>
<p>We do not check the rest of the environment so it is up to the user to make sure all variables which influence the expression output are states. Likewise if the code in the expression changes a new value will be cached but if the contents of a function used in the expression changes thsi might not be picked up.</p>
<div class="sourceCode" id="cb2"><pre class="downlit">
<span class="co"># Ten iterations of the same code</span>
<span class="co"># only the first iteration is actually calculated. The rest are loaded from disk.</span>

<span class="kw">for</span> <span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="fl">10</span><span class="op">)</span> <span class="op">{</span>
  
  <span class="va">quantCutOff</span> <span class="op">=</span> <span class="fl">0.95</span>
  <span class="va">start</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Sys.time.html">Sys.time</a></span><span class="op">(</span><span class="op">)</span>
  
  <span class="va">fit</span> <span class="op">=</span> <span class="fu">ggrrr</span><span class="fu">::</span><span class="fu"><a href="../reference/cached.html">cached</a></span><span class="op">(</span><span class="op">{</span>
    
    <span class="va">expensiveDiamonds</span> <span class="op">=</span> <span class="va">diamonds</span> <span class="op">%&gt;%</span> <span class="fu">mutate</span><span class="op">(</span>expensive <span class="op">=</span> <span class="va">price</span><span class="op">&gt;</span><span class="fu"><a href="https://rdrr.io/r/stats/quantile.html">quantile</a></span><span class="op">(</span><span class="va">price</span>,<span class="va">quantCutOff</span><span class="op">)</span><span class="op">)</span>
    <span class="fu"><a href="https://rdrr.io/r/stats/glm.html">glm</a></span><span class="op">(</span><span class="va">expensive</span> <span class="op">~</span> <span class="va">carat</span><span class="op">+</span><span class="va">cut</span><span class="op">+</span><span class="va">color</span><span class="op">+</span><span class="va">clarity</span><span class="op">+</span><span class="va">depth</span><span class="op">+</span><span class="va">table</span>, family <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/family.html">binomial</a></span><span class="op">(</span>link<span class="op">=</span><span class="st">'logit'</span><span class="op">)</span>, data<span class="op">=</span><span class="va">expensiveDiamonds</span> <span class="op">)</span>
    
  <span class="op">}</span>, <span class="va">diamonds</span>, <span class="va">quantCutOff</span> <span class="op">)</span>
  
  <span class="va">duration</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Sys.time.html">Sys.time</a></span><span class="op">(</span><span class="op">)</span><span class="op">-</span><span class="va">start</span>
  <span class="fu"><a href="https://rdrr.io/r/base/cat.html">cat</a></span><span class="op">(</span><span class="st">"iteration:"</span>,<span class="va">i</span>,<span class="st">" duration: "</span>,<span class="va">duration</span>,<span class="st">"\n"</span><span class="op">)</span>
  
<span class="op">}</span></pre></div>
<pre><code>## caching item: /tmp/RtmpMc0b0Z/cached-16750e3a9ecb64b1823a9e7731a11559-c6e03ac8f53dbecd19a32787db92df7a.rda</code></pre>
<pre><code>## Warning: glm.fit: fitted probabilities numerically 0 or 1 occurred</code></pre>
<pre><code>## iteration: 1  duration:  1.332463</code></pre>
<pre><code>## using cached item: /tmp/RtmpMc0b0Z/cached-16750e3a9ecb64b1823a9e7731a11559-c6e03ac8f53dbecd19a32787db92df7a.rda</code></pre>
<pre><code>## iteration: 2  duration:  0.1116016</code></pre>
<pre><code>## using cached item: /tmp/RtmpMc0b0Z/cached-16750e3a9ecb64b1823a9e7731a11559-c6e03ac8f53dbecd19a32787db92df7a.rda</code></pre>
<pre><code>## iteration: 3  duration:  0.1200054</code></pre>
<pre><code>## using cached item: /tmp/RtmpMc0b0Z/cached-16750e3a9ecb64b1823a9e7731a11559-c6e03ac8f53dbecd19a32787db92df7a.rda</code></pre>
<pre><code>## iteration: 4  duration:  0.1691024</code></pre>
<pre><code>## using cached item: /tmp/RtmpMc0b0Z/cached-16750e3a9ecb64b1823a9e7731a11559-c6e03ac8f53dbecd19a32787db92df7a.rda</code></pre>
<pre><code>## iteration: 5  duration:  0.107306</code></pre>
<pre><code>## using cached item: /tmp/RtmpMc0b0Z/cached-16750e3a9ecb64b1823a9e7731a11559-c6e03ac8f53dbecd19a32787db92df7a.rda</code></pre>
<pre><code>## iteration: 6  duration:  0.107919</code></pre>
<pre><code>## using cached item: /tmp/RtmpMc0b0Z/cached-16750e3a9ecb64b1823a9e7731a11559-c6e03ac8f53dbecd19a32787db92df7a.rda</code></pre>
<pre><code>## iteration: 7  duration:  0.1098554</code></pre>
<pre><code>## using cached item: /tmp/RtmpMc0b0Z/cached-16750e3a9ecb64b1823a9e7731a11559-c6e03ac8f53dbecd19a32787db92df7a.rda</code></pre>
<pre><code>## iteration: 8  duration:  0.1098242</code></pre>
<pre><code>## using cached item: /tmp/RtmpMc0b0Z/cached-16750e3a9ecb64b1823a9e7731a11559-c6e03ac8f53dbecd19a32787db92df7a.rda</code></pre>
<pre><code>## iteration: 9  duration:  0.1113791</code></pre>
<pre><code>## using cached item: /tmp/RtmpMc0b0Z/cached-16750e3a9ecb64b1823a9e7731a11559-c6e03ac8f53dbecd19a32787db92df7a.rda</code></pre>
<pre><code>## iteration: 10  duration:  0.1071141</code></pre>
</div>
<div id="re-caching-when-code-changes" class="section level2">
<h2 class="hasAnchor">
<a href="#re-caching-when-code-changes" class="anchor"></a>Re-caching when code changes</h2>
<p>A change in the code (in this example a trivial change in a variable name) will result in the item being re-cached. White space changes do not trigger recalculation.</p>
<div class="sourceCode" id="cb24"><pre class="downlit">
<span class="va">fit</span> <span class="op">=</span> <span class="fu">ggrrr</span><span class="fu">::</span><span class="fu"><a href="../reference/cached.html">cached</a></span><span class="op">(</span><span class="op">{</span>
  <span class="va">expensiveDiamonds2</span> <span class="op">=</span> <span class="va">diamonds</span> <span class="op">%&gt;%</span> <span class="fu">mutate</span><span class="op">(</span>expensive <span class="op">=</span> <span class="va">price</span><span class="op">&gt;</span><span class="fu"><a href="https://rdrr.io/r/stats/quantile.html">quantile</a></span><span class="op">(</span><span class="va">price</span>,<span class="va">quantCutOff</span><span class="op">)</span><span class="op">)</span>
  <span class="fu"><a href="https://rdrr.io/r/stats/glm.html">glm</a></span><span class="op">(</span><span class="va">expensive</span> <span class="op">~</span> <span class="va">carat</span><span class="op">+</span><span class="va">cut</span><span class="op">+</span><span class="va">color</span><span class="op">+</span><span class="va">clarity</span><span class="op">+</span><span class="va">depth</span><span class="op">+</span><span class="va">table</span>, family <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/family.html">binomial</a></span><span class="op">(</span>link<span class="op">=</span><span class="st">'logit'</span><span class="op">)</span>, data<span class="op">=</span><span class="va">expensiveDiamonds2</span> <span class="op">)</span>
<span class="op">}</span>, <span class="va">diamonds</span>, <span class="va">quantCutOff</span> <span class="op">)</span></pre></div>
<pre><code>## caching item: /tmp/RtmpMc0b0Z/cached-94ffe1af5a1862d5f7f9fb103b5a66fc-c6e03ac8f53dbecd19a32787db92df7a.rda</code></pre>
<pre><code>## Warning: glm.fit: fitted probabilities numerically 0 or 1 occurred</code></pre>
</div>
<div id="forcing-execution-of-cached-item" class="section level2">
<h2 class="hasAnchor">
<a href="#forcing-execution-of-cached-item" class="anchor"></a>Forcing execution of cached item</h2>
<p>If you want to defeat the caching for a one off execution the <code>.nocache</code> option achieves that.</p>
<div class="sourceCode" id="cb27"><pre class="downlit">
<span class="va">fit</span> <span class="op">=</span> <span class="fu">ggrrr</span><span class="fu">::</span><span class="fu"><a href="../reference/cached.html">cached</a></span><span class="op">(</span><span class="op">{</span>
  <span class="va">expensiveDiamonds</span> <span class="op">=</span> <span class="va">diamonds</span> <span class="op">%&gt;%</span> <span class="fu">mutate</span><span class="op">(</span>expensive <span class="op">=</span> <span class="va">price</span><span class="op">&gt;</span><span class="fu"><a href="https://rdrr.io/r/stats/quantile.html">quantile</a></span><span class="op">(</span><span class="va">price</span>,<span class="va">quantCutOff</span><span class="op">)</span><span class="op">)</span>
  <span class="fu"><a href="https://rdrr.io/r/stats/glm.html">glm</a></span><span class="op">(</span><span class="va">expensive</span> <span class="op">~</span> <span class="va">carat</span><span class="op">+</span><span class="va">cut</span><span class="op">+</span><span class="va">color</span><span class="op">+</span><span class="va">clarity</span><span class="op">+</span><span class="va">depth</span><span class="op">+</span><span class="va">table</span>, family <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/family.html">binomial</a></span><span class="op">(</span>link<span class="op">=</span><span class="st">'logit'</span><span class="op">)</span>, data<span class="op">=</span><span class="va">expensiveDiamonds</span> <span class="op">)</span>
<span class="op">}</span>, <span class="va">diamonds</span>, <span class="va">quantCutOff</span>, .nocache <span class="op">=</span> <span class="cn">TRUE</span> <span class="op">)</span></pre></div>
<pre><code>## caching item: /tmp/RtmpMc0b0Z/cached-16750e3a9ecb64b1823a9e7731a11559-c6e03ac8f53dbecd19a32787db92df7a.rda</code></pre>
<pre><code>## Warning: glm.fit: fitted probabilities numerically 0 or 1 occurred</code></pre>
</div>
<div id="globally-disabling-cache" class="section level2">
<h2 class="hasAnchor">
<a href="#globally-disabling-cache" class="anchor"></a>Globally disabling cache</h2>
<p>You might want to cache interim results while developing (for speed) and disable the cache completely during final analysis.</p>
<div class="sourceCode" id="cb30"><pre class="downlit">
<span class="va">oldopt</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/options.html">options</a></span><span class="op">(</span>cache.disable <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>

<span class="va">fit</span> <span class="op">=</span> <span class="fu">ggrrr</span><span class="fu">::</span><span class="fu"><a href="../reference/cached.html">cached</a></span><span class="op">(</span><span class="op">{</span>
  <span class="va">expensiveDiamonds</span> <span class="op">=</span> <span class="va">diamonds</span> <span class="op">%&gt;%</span> <span class="fu">mutate</span><span class="op">(</span>expensive <span class="op">=</span> <span class="va">price</span><span class="op">&gt;</span><span class="fu"><a href="https://rdrr.io/r/stats/quantile.html">quantile</a></span><span class="op">(</span><span class="va">price</span>,<span class="va">quantCutOff</span><span class="op">)</span><span class="op">)</span>
  <span class="fu"><a href="https://rdrr.io/r/stats/glm.html">glm</a></span><span class="op">(</span><span class="va">expensive</span> <span class="op">~</span> <span class="va">carat</span><span class="op">+</span><span class="va">cut</span><span class="op">+</span><span class="va">color</span><span class="op">+</span><span class="va">clarity</span><span class="op">+</span><span class="va">depth</span><span class="op">+</span><span class="va">table</span>, family <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/family.html">binomial</a></span><span class="op">(</span>link<span class="op">=</span><span class="st">'logit'</span><span class="op">)</span>, data<span class="op">=</span><span class="va">expensiveDiamonds</span> <span class="op">)</span>
<span class="op">}</span>, <span class="va">diamonds</span>, <span class="va">quantCutOff</span><span class="op">)</span></pre></div>
<pre><code>## caching item: /tmp/RtmpMc0b0Z/cached-16750e3a9ecb64b1823a9e7731a11559-c6e03ac8f53dbecd19a32787db92df7a.rda</code></pre>
<pre><code>## Warning: glm.fit: fitted probabilities numerically 0 or 1 occurred</code></pre>
<div class="sourceCode" id="cb33"><pre class="downlit">
<span class="fu"><a href="https://rdrr.io/r/base/options.html">options</a></span><span class="op">(</span><span class="va">oldopt</span><span class="op">)</span></pre></div>
</div>
<div id="manually-removing-items-from-cache" class="section level2">
<h2 class="hasAnchor">
<a href="#manually-removing-items-from-cache" class="anchor"></a>Manually removing items from cache</h2>
<p>In general items can be left in the cache, and they will get removed when it is determined that they are stale. A manual flush of the cache can be done like this. Usually the interactive option will be omitted if run at the command line</p>
<div class="sourceCode" id="cb34"><pre class="downlit">
<span class="fu">ggrrr</span><span class="fu">::</span><span class="fu"><a href="../reference/cache_clear.html">cache_clear</a></span><span class="op">(</span>interactive <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></pre></div>
</div>
<div id="caching-multiple-types-of-data" class="section level2">
<h2 class="hasAnchor">
<a href="#caching-multiple-types-of-data" class="anchor"></a>Caching multiple types of data</h2>
<p>Controlling the naming of the cache items helps to keep track of the items in the cache if you are manually inspecting it. If the items follow a naming convention then deleting items from the cache can then be done on a type by type basis.</p>
<div class="sourceCode" id="cb35"><pre class="downlit">
<span class="va">fit</span> <span class="op">=</span> <span class="fu">ggrrr</span><span class="fu">::</span><span class="fu"><a href="../reference/cached.html">cached</a></span><span class="op">(</span><span class="op">{</span>
  <span class="va">expensiveDiamonds</span> <span class="op">=</span> <span class="va">diamonds</span> <span class="op">%&gt;%</span> <span class="fu">mutate</span><span class="op">(</span>expensive <span class="op">=</span> <span class="va">price</span><span class="op">&gt;</span><span class="fu"><a href="https://rdrr.io/r/stats/quantile.html">quantile</a></span><span class="op">(</span><span class="va">price</span>,<span class="va">quantCutOff</span><span class="op">)</span><span class="op">)</span>
  <span class="fu"><a href="https://rdrr.io/r/stats/glm.html">glm</a></span><span class="op">(</span><span class="va">expensive</span> <span class="op">~</span> <span class="va">carat</span><span class="op">+</span><span class="va">cut</span><span class="op">+</span><span class="va">color</span><span class="op">+</span><span class="va">clarity</span><span class="op">+</span><span class="va">depth</span><span class="op">+</span><span class="va">table</span>, family <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/family.html">binomial</a></span><span class="op">(</span>link<span class="op">=</span><span class="st">'logit'</span><span class="op">)</span>, data<span class="op">=</span><span class="va">expensiveDiamonds</span> <span class="op">)</span>
<span class="op">}</span>, <span class="va">diamonds</span>, <span class="va">quantCutOff</span>, .prefix <span class="op">=</span> <span class="st">"diamonds"</span><span class="op">)</span></pre></div>
<pre><code>## caching item: /tmp/RtmpMc0b0Z/diamonds-16750e3a9ecb64b1823a9e7731a11559-c6e03ac8f53dbecd19a32787db92df7a.rda</code></pre>
<pre><code>## Warning: glm.fit: fitted probabilities numerically 0 or 1 occurred</code></pre>
<div class="sourceCode" id="cb38"><pre class="downlit">
<span class="va">fit2</span> <span class="op">=</span> <span class="fu">ggrrr</span><span class="fu">::</span><span class="fu"><a href="../reference/cached.html">cached</a></span><span class="op">(</span><span class="op">{</span>
  <span class="va">fastCars</span> <span class="op">=</span> <span class="va">mtcars</span> <span class="op">%&gt;%</span> <span class="fu">mutate</span><span class="op">(</span>fast <span class="op">=</span> <span class="va">hp</span><span class="op">&gt;</span><span class="fu"><a href="https://rdrr.io/r/stats/quantile.html">quantile</a></span><span class="op">(</span><span class="va">hp</span>,<span class="va">quantCutOff</span><span class="op">)</span><span class="op">)</span>
  <span class="fu"><a href="https://rdrr.io/r/stats/glm.html">glm</a></span><span class="op">(</span><span class="va">fast</span> <span class="op">~</span> <span class="va">mpg</span><span class="op">+</span><span class="va">cyl</span><span class="op">+</span><span class="va">disp</span><span class="op">+</span><span class="va">drat</span><span class="op">+</span><span class="va">wt</span><span class="op">+</span><span class="va">gear</span>, family <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/family.html">binomial</a></span><span class="op">(</span>link<span class="op">=</span><span class="st">'logit'</span><span class="op">)</span>, data<span class="op">=</span><span class="va">fastCars</span> <span class="op">)</span>
<span class="op">}</span>, <span class="va">mtcars</span>, <span class="va">quantCutOff</span>, .prefix <span class="op">=</span> <span class="st">"cars"</span><span class="op">)</span></pre></div>
<pre><code>## caching item: /tmp/RtmpMc0b0Z/cars-d56df4fc92d67dedede94f6c0e13d430-d80edaedd01c0689a508e11d7fa6c365.rda</code></pre>
<pre><code>## Warning: glm.fit: algorithm did not converge

## Warning: glm.fit: fitted probabilities numerically 0 or 1 occurred</code></pre>
<div class="sourceCode" id="cb41"><pre class="downlit">
<span class="fu">ggrrr</span><span class="fu">::</span><span class="fu"><a href="../reference/cache_clear.html">cache_clear</a></span><span class="op">(</span>.prefix <span class="op">=</span> <span class="st">"cars"</span>, interactive <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span>

<span class="fu">ggrrr</span><span class="fu">::</span><span class="fu"><a href="../reference/cache_clear.html">cache_clear</a></span><span class="op">(</span>.prefix <span class="op">=</span> <span class="st">"diamonds"</span>, interactive <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></pre></div>
</div>
<div id="caching-data-in-multiple-stages-of-analysis" class="section level2">
<h2 class="hasAnchor">
<a href="#caching-data-in-multiple-stages-of-analysis" class="anchor"></a>Caching data in multiple stages of analysis</h2>
<p>One use of this is to allow analysis to be cached in stages, and deleting cached content for unsuccessful stages.</p>
<p>N.b. as cache_clear uses regex it is probably best to avoid full stop characters in the prefix.</p>
<div class="sourceCode" id="cb42"><pre class="downlit">
<span class="va">oldopts</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/options.html">options</a></span><span class="op">(</span>cache.item.prefix <span class="op">=</span> <span class="st">"stage-1"</span><span class="op">)</span>

<span class="va">fit</span> <span class="op">=</span> <span class="fu">ggrrr</span><span class="fu">::</span><span class="fu"><a href="../reference/cached.html">cached</a></span><span class="op">(</span><span class="op">{</span>
  <span class="va">expensiveDiamonds</span> <span class="op">=</span> <span class="va">diamonds</span> <span class="op">%&gt;%</span> <span class="fu">mutate</span><span class="op">(</span>expensive <span class="op">=</span> <span class="va">price</span><span class="op">&gt;</span><span class="fu"><a href="https://rdrr.io/r/stats/quantile.html">quantile</a></span><span class="op">(</span><span class="va">price</span>,<span class="va">quantCutOff</span><span class="op">)</span><span class="op">)</span>
  <span class="fu"><a href="https://rdrr.io/r/stats/glm.html">glm</a></span><span class="op">(</span><span class="va">expensive</span> <span class="op">~</span> <span class="va">carat</span><span class="op">+</span><span class="va">cut</span><span class="op">+</span><span class="va">color</span><span class="op">+</span><span class="va">clarity</span><span class="op">+</span><span class="va">depth</span><span class="op">+</span><span class="va">table</span>, family <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/family.html">binomial</a></span><span class="op">(</span>link<span class="op">=</span><span class="st">'logit'</span><span class="op">)</span>, data<span class="op">=</span><span class="va">expensiveDiamonds</span> <span class="op">)</span>
<span class="op">}</span>, <span class="va">diamonds</span>, <span class="va">quantCutOff</span><span class="op">)</span></pre></div>
<pre><code>## caching item: /tmp/RtmpMc0b0Z/stage-1-16750e3a9ecb64b1823a9e7731a11559-c6e03ac8f53dbecd19a32787db92df7a.rda</code></pre>
<pre><code>## Warning: glm.fit: fitted probabilities numerically 0 or 1 occurred</code></pre>
<div class="sourceCode" id="cb45"><pre class="downlit">
<span class="fu"><a href="https://rdrr.io/r/base/options.html">options</a></span><span class="op">(</span>cache.item.prefix <span class="op">=</span> <span class="st">"stage-2"</span><span class="op">)</span>

<span class="va">fit2</span> <span class="op">=</span> <span class="fu">ggrrr</span><span class="fu">::</span><span class="fu"><a href="../reference/cached.html">cached</a></span><span class="op">(</span><span class="op">{</span>
  <span class="va">fastCars</span> <span class="op">=</span> <span class="va">mtcars</span> <span class="op">%&gt;%</span> <span class="fu">mutate</span><span class="op">(</span>fast <span class="op">=</span> <span class="va">hp</span><span class="op">&gt;</span><span class="fu"><a href="https://rdrr.io/r/stats/quantile.html">quantile</a></span><span class="op">(</span><span class="va">hp</span>,<span class="va">quantCutOff</span><span class="op">)</span><span class="op">)</span>
  <span class="fu"><a href="https://rdrr.io/r/stats/glm.html">glm</a></span><span class="op">(</span><span class="va">fast</span> <span class="op">~</span> <span class="va">mpg</span><span class="op">+</span><span class="va">cyl</span><span class="op">+</span><span class="va">disp</span><span class="op">+</span><span class="va">drat</span><span class="op">+</span><span class="va">wt</span><span class="op">+</span><span class="va">gear</span>, family <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/family.html">binomial</a></span><span class="op">(</span>link<span class="op">=</span><span class="st">'logit'</span><span class="op">)</span>, data<span class="op">=</span><span class="va">fastCars</span> <span class="op">)</span>
<span class="op">}</span>, <span class="va">mtcars</span>, <span class="va">quantCutOff</span><span class="op">)</span></pre></div>
<pre><code>## caching item: /tmp/RtmpMc0b0Z/stage-2-d56df4fc92d67dedede94f6c0e13d430-d80edaedd01c0689a508e11d7fa6c365.rda</code></pre>
<pre><code>## Warning: glm.fit: algorithm did not converge

## Warning: glm.fit: fitted probabilities numerically 0 or 1 occurred</code></pre>
<div class="sourceCode" id="cb48"><pre class="downlit">
<span class="fu">ggrrr</span><span class="fu">::</span><span class="fu"><a href="../reference/cache_clear.html">cache_clear</a></span><span class="op">(</span>.prefix <span class="op">=</span> <span class="st">"stage-1"</span>, interactive <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span>
<span class="fu">ggrrr</span><span class="fu">::</span><span class="fu"><a href="../reference/cache_clear.html">cache_clear</a></span><span class="op">(</span>.prefix <span class="op">=</span> <span class="st">"stage-2"</span>, interactive <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span>

<span class="fu"><a href="https://rdrr.io/r/base/options.html">options</a></span><span class="op">(</span><span class="va">oldopts</span><span class="op">)</span></pre></div>
</div>
<div id="caching-a-url-download" class="section level2">
<h2 class="hasAnchor">
<a href="#caching-a-url-download" class="anchor"></a>Caching a url download</h2>
<p>Getting a file from the internet and locally caching. This does not check for remote changes. as before forcing the re-download can be achieved with .nocache.</p>
<div class="sourceCode" id="cb49"><pre class="downlit">
<span class="va">file</span> <span class="op">=</span> <span class="fu">ggrrr</span><span class="fu">::</span><span class="fu"><a href="../reference/cache_download.html">cache_download</a></span><span class="op">(</span>
  <span class="st">"https://raw.githubusercontent.com/terminological/arear/main/data-raw/NHSSurgeCapacityMarch2020.csv"</span>,
  .extn <span class="op">=</span> <span class="st">"csv"</span>
<span class="op">)</span></pre></div>
<pre><code>## using cached item: /home/terminological/.cache/ggrrr-download/f0397005ebb4bfc522ad13ddcf33306c-NHSSurgeCapacityMarch2020.csv</code></pre>
</div>
<div id="downloading-changing-data" class="section level2">
<h2 class="hasAnchor">
<a href="#downloading-changing-data" class="anchor"></a>Downloading changing data</h2>
<p>If you want a daily download setting the .stale parameter to one day will download the data at most once per day. Staleness is determined by the number of days from 2am on the current day in the current time-zone. A item cached for only one day becomes stale at 2am the day after it is cached. The time is configurable and for example <code><a href="https://rdrr.io/r/base/options.html">option(cache.time_day_starts = 0)</a></code> would set this to be midnight. Automated analysis using caches and updated data should ensure that analysis does not run over this time point otherwise it may end up unexpectedly using old data.</p>
<div class="sourceCode" id="cb51"><pre class="downlit">
<span class="co"># number of days before reloading</span>
<span class="va">file</span> <span class="op">=</span> <span class="fu">ggrrr</span><span class="fu">::</span><span class="fu"><a href="../reference/cache_download.html">cache_download</a></span><span class="op">(</span>
  <span class="st">"https://raw.githubusercontent.com/terminological/arear/main/data-raw/NHSSurgeCapacityMarch2020.csv"</span>,
  .stale <span class="op">=</span> <span class="fl">1</span>,
  .extn <span class="op">=</span> <span class="st">"csv"</span>
<span class="op">)</span></pre></div>
<pre><code>## using cached item: /home/terminological/.cache/ggrrr-download/f0397005ebb4bfc522ad13ddcf33306c-NHSSurgeCapacityMarch2020.csv</code></pre>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p>Developed by Rob Challen.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.6.1.</p>
</div>

      </footer>
</div>

  


  </body>
</html>
