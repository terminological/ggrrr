<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="description" content="ggrrr">
<title>Caching functions â€¢ ggrrr</title>
<script src="../../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- bootstrap-toc --><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@v1.0.1/dist/bootstrap-toc.min.js" integrity="sha256-4veVQbu7//Lk5TSmc7YV48MxtMy98e26cf5MrgZYnwo=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.11/clipboard.min.js" integrity="sha512-7O5pXpc0oCRrxk8RUfDYFgn0nO1t+jLuIOQdOMRp4APB7uZ4vSjspzp5y6YDtDs4VzUSTbWzBFZ/LKJhnyFOKw==" crossorigin="anonymous" referrerpolicy="no-referrer"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../../pkgdown.js"></script><meta property="og:title" content="Caching functions">
<meta property="og:description" content="ggrrr">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-light navbar-expand-lg bg-light" data-bs-theme="light"><div class="container">
    
    <a class="navbar-brand me-2" href="../../index.html">ggrrr</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.0.0.9024</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item">
  <a class="nav-link" href="../../reference/index.html">Reference</a>
</li>
<li class="active nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-articles">Articles</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-articles">
    <a class="dropdown-item" href="../../articles/web/cache-functions.html">Caching functions</a>
    <a class="dropdown-item" href="../../articles/web/figure-functions.html">Figure functions</a>
    <a class="dropdown-item" href="../../articles/web/font-functions.html">Font functions</a>
    <a class="dropdown-item" href="../../articles/web/getting-started.html">Getting Started</a>
    <a class="dropdown-item" href="../../articles/web/other-table-formats.html">Other table formats</a>
    <a class="dropdown-item" href="../../articles/struct-lists.html">Structured lists</a>
    <a class="dropdown-item" href="../../articles/web/table-functions.html">Table functions</a>
  </div>
</li>
<li class="nav-item">
  <a class="nav-link" href="../../news/index.html">Changelog</a>
</li>
      </ul>
<form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../../search.json" id="search-input" placeholder="Search for" autocomplete="off">
</form>

      <ul class="navbar-nav">
<li class="nav-item">
  <a class="external-link nav-link" href="https://github.com/terminological/ggrrr/" aria-label="github">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>

    
  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="" class="logo" alt=""><h1>Caching functions</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/terminological/ggrrr/blob/HEAD/vignettes/web/cache-functions.Rmd" class="external-link"><code>vignettes/web/cache-functions.Rmd</code></a></small>
      <div class="d-none name"><code>cache-functions.Rmd</code></div>
    </div>

    
    
<p><code>ggrrr</code> supports a super simple passthrough caching layer.
This assumes calculations are deterministic, and with a stated set of
inputs will compute and cache the result.</p>
<p>Setting the caching location should be transparent. The default
directory is the user cache directory, but in an analysis project a
specific cache directory may be preferred</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Setting a cache in an analysis project might be in a sub-directory of the project</span></span>
<span><span class="co"># options("cache.dir"=here::here("cache"))</span></span>
<span></span>
<span><span class="co"># If in a package you might be using a package specific cache</span></span>
<span><span class="co"># options("cache.dir"=rappdirs::user_cache_dir("my-package"))</span></span>
<span></span>
<span><span class="co"># for our purposes a temporary directory is OK, but caching to a tempdir will only persist as long as the session is active.</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/options.html" class="external-link">options</a></span><span class="op">(</span><span class="st">"cache.dir"</span><span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/tempfile.html" class="external-link">tempdir</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<div class="section level2">
<h2 id="caching-an-item">Caching an item<a class="anchor" aria-label="anchor" href="#caching-an-item"></a>
</h2>
<p>The item caches is the result of running an expression with in the
current environment. We manually specify which items in the environment
may affect the outcome. The cache key is a combination of the hash of
the expression and the input data.</p>
<p>We do not check the rest of the environment so it is up to the user
to make sure all variables which influence the expression output are
states. Likewise if the code in the expression changes a new value will
be cached but if the contents of a function used in the expression
changes thsi might not be picked up.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Ten iterations of the same code</span></span>
<span><span class="co"># only the first iteration is actually calculated. The rest are loaded from disk.</span></span>
<span></span>
<span><span class="kw">for</span> <span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="fl">10</span><span class="op">)</span> <span class="op">{</span></span>
<span>  </span>
<span>  <span class="va">quantCutOff</span> <span class="op">=</span> <span class="fl">0.95</span></span>
<span>  <span class="va">start</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Sys.time.html" class="external-link">Sys.time</a></span><span class="op">(</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="va">fit</span> <span class="op">=</span> <span class="fu"><a href="../../reference/cached.html">cached</a></span><span class="op">(</span><span class="op">{</span></span>
<span>    </span>
<span>    <span class="va">expensiveDiamonds</span> <span class="op">=</span> <span class="va">diamonds</span> <span class="op"><a href="../../reference/pipe.html">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>expensive <span class="op">=</span> <span class="va">price</span><span class="op">&gt;</span><span class="fu"><a href="https://rdrr.io/r/stats/quantile.html" class="external-link">quantile</a></span><span class="op">(</span><span class="va">price</span>,<span class="va">quantCutOff</span><span class="op">)</span><span class="op">)</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/stats/glm.html" class="external-link">glm</a></span><span class="op">(</span><span class="va">expensive</span> <span class="op">~</span> <span class="va">carat</span><span class="op">+</span><span class="va">cut</span><span class="op">+</span><span class="va">color</span><span class="op">+</span><span class="va">clarity</span><span class="op">+</span><span class="va">depth</span><span class="op">+</span><span class="va">table</span>, family <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/family.html" class="external-link">binomial</a></span><span class="op">(</span>link<span class="op">=</span><span class="st">'logit'</span><span class="op">)</span>, data<span class="op">=</span><span class="va">expensiveDiamonds</span> <span class="op">)</span></span>
<span>    </span>
<span>  <span class="op">}</span>, <span class="va">diamonds</span>, <span class="va">quantCutOff</span> <span class="op">)</span></span>
<span>  </span>
<span>  <span class="va">duration</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Sys.time.html" class="external-link">Sys.time</a></span><span class="op">(</span><span class="op">)</span><span class="op">-</span><span class="va">start</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"iteration:"</span>,<span class="va">i</span>,<span class="st">" duration: "</span>,<span class="va">duration</span>,<span class="st">"\n"</span><span class="op">)</span></span>
<span>  </span>
<span><span class="op">}</span></span></code></pre></div>
<pre><code><span><span class="co">## caching item: /tmp/RtmpZBelAG/cached-4d33d39f25b44f2dd0e3f1c284e46470-c6e03ac8f53dbecd19a32787db92df7a.rda</span></span></code></pre>
<pre><code><span><span class="co">## Warning: glm.fit: fitted probabilities numerically 0 or 1 occurred</span></span></code></pre>
<pre><code><span><span class="co">## iteration: 1  duration:  1.159843</span></span></code></pre>
<pre><code><span><span class="co">## using cached item: /tmp/RtmpZBelAG/cached-4d33d39f25b44f2dd0e3f1c284e46470-c6e03ac8f53dbecd19a32787db92df7a.rda</span></span></code></pre>
<pre><code><span><span class="co">## iteration: 2  duration:  0.09126902</span></span></code></pre>
<pre><code><span><span class="co">## using cached item: /tmp/RtmpZBelAG/cached-4d33d39f25b44f2dd0e3f1c284e46470-c6e03ac8f53dbecd19a32787db92df7a.rda</span></span></code></pre>
<pre><code><span><span class="co">## iteration: 3  duration:  0.09219599</span></span></code></pre>
<pre><code><span><span class="co">## using cached item: /tmp/RtmpZBelAG/cached-4d33d39f25b44f2dd0e3f1c284e46470-c6e03ac8f53dbecd19a32787db92df7a.rda</span></span></code></pre>
<pre><code><span><span class="co">## iteration: 4  duration:  0.09015965</span></span></code></pre>
<pre><code><span><span class="co">## using cached item: /tmp/RtmpZBelAG/cached-4d33d39f25b44f2dd0e3f1c284e46470-c6e03ac8f53dbecd19a32787db92df7a.rda</span></span></code></pre>
<pre><code><span><span class="co">## iteration: 5  duration:  0.1410227</span></span></code></pre>
<pre><code><span><span class="co">## using cached item: /tmp/RtmpZBelAG/cached-4d33d39f25b44f2dd0e3f1c284e46470-c6e03ac8f53dbecd19a32787db92df7a.rda</span></span></code></pre>
<pre><code><span><span class="co">## iteration: 6  duration:  0.08353686</span></span></code></pre>
<pre><code><span><span class="co">## using cached item: /tmp/RtmpZBelAG/cached-4d33d39f25b44f2dd0e3f1c284e46470-c6e03ac8f53dbecd19a32787db92df7a.rda</span></span></code></pre>
<pre><code><span><span class="co">## iteration: 7  duration:  0.08875036</span></span></code></pre>
<pre><code><span><span class="co">## using cached item: /tmp/RtmpZBelAG/cached-4d33d39f25b44f2dd0e3f1c284e46470-c6e03ac8f53dbecd19a32787db92df7a.rda</span></span></code></pre>
<pre><code><span><span class="co">## iteration: 8  duration:  0.08673692</span></span></code></pre>
<pre><code><span><span class="co">## using cached item: /tmp/RtmpZBelAG/cached-4d33d39f25b44f2dd0e3f1c284e46470-c6e03ac8f53dbecd19a32787db92df7a.rda</span></span></code></pre>
<pre><code><span><span class="co">## iteration: 9  duration:  0.0854876</span></span></code></pre>
<pre><code><span><span class="co">## using cached item: /tmp/RtmpZBelAG/cached-4d33d39f25b44f2dd0e3f1c284e46470-c6e03ac8f53dbecd19a32787db92df7a.rda</span></span></code></pre>
<pre><code><span><span class="co">## iteration: 10  duration:  0.08891273</span></span></code></pre>
</div>
<div class="section level2">
<h2 id="re-caching-when-code-changes">Re-caching when code changes<a class="anchor" aria-label="anchor" href="#re-caching-when-code-changes"></a>
</h2>
<p>A change in the code (in this example a trivial change in a variable
name) will result in the item being re-cached. White space changes do
not trigger recalculation.</p>
<div class="sourceCode" id="cb24"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">fit</span> <span class="op">=</span> <span class="fu"><a href="../../reference/cached.html">cached</a></span><span class="op">(</span><span class="op">{</span></span>
<span>  <span class="va">expensiveDiamonds2</span> <span class="op">=</span> <span class="va">diamonds</span> <span class="op"><a href="../../reference/pipe.html">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>expensive <span class="op">=</span> <span class="va">price</span><span class="op">&gt;</span><span class="fu"><a href="https://rdrr.io/r/stats/quantile.html" class="external-link">quantile</a></span><span class="op">(</span><span class="va">price</span>,<span class="va">quantCutOff</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/stats/glm.html" class="external-link">glm</a></span><span class="op">(</span><span class="va">expensive</span> <span class="op">~</span> <span class="va">carat</span><span class="op">+</span><span class="va">cut</span><span class="op">+</span><span class="va">color</span><span class="op">+</span><span class="va">clarity</span><span class="op">+</span><span class="va">depth</span><span class="op">+</span><span class="va">table</span>, family <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/family.html" class="external-link">binomial</a></span><span class="op">(</span>link<span class="op">=</span><span class="st">'logit'</span><span class="op">)</span>, data<span class="op">=</span><span class="va">expensiveDiamonds2</span> <span class="op">)</span></span>
<span><span class="op">}</span>, <span class="va">diamonds</span>, <span class="va">quantCutOff</span> <span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## using cached item: /tmp/RtmpZBelAG/cached-4d33d39f25b44f2dd0e3f1c284e46470-c6e03ac8f53dbecd19a32787db92df7a.rda</span></span></code></pre>
</div>
<div class="section level2">
<h2 id="forcing-execution-of-cached-item">Forcing execution of cached item<a class="anchor" aria-label="anchor" href="#forcing-execution-of-cached-item"></a>
</h2>
<p>If you want to defeat the caching for a one off execution the
<code>.nocache</code> option achieves that.</p>
<div class="sourceCode" id="cb26"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">fit</span> <span class="op">=</span> <span class="fu"><a href="../../reference/cached.html">cached</a></span><span class="op">(</span><span class="op">{</span></span>
<span>  <span class="va">expensiveDiamonds</span> <span class="op">=</span> <span class="va">diamonds</span> <span class="op"><a href="../../reference/pipe.html">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>expensive <span class="op">=</span> <span class="va">price</span><span class="op">&gt;</span><span class="fu"><a href="https://rdrr.io/r/stats/quantile.html" class="external-link">quantile</a></span><span class="op">(</span><span class="va">price</span>,<span class="va">quantCutOff</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/stats/glm.html" class="external-link">glm</a></span><span class="op">(</span><span class="va">expensive</span> <span class="op">~</span> <span class="va">carat</span><span class="op">+</span><span class="va">cut</span><span class="op">+</span><span class="va">color</span><span class="op">+</span><span class="va">clarity</span><span class="op">+</span><span class="va">depth</span><span class="op">+</span><span class="va">table</span>, family <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/family.html" class="external-link">binomial</a></span><span class="op">(</span>link<span class="op">=</span><span class="st">'logit'</span><span class="op">)</span>, data<span class="op">=</span><span class="va">expensiveDiamonds</span> <span class="op">)</span></span>
<span><span class="op">}</span>, <span class="va">diamonds</span>, <span class="va">quantCutOff</span>, .nocache <span class="op">=</span> <span class="cn">TRUE</span> <span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## caching item: /tmp/RtmpZBelAG/cached-4d33d39f25b44f2dd0e3f1c284e46470-c6e03ac8f53dbecd19a32787db92df7a.rda</span></span></code></pre>
<pre><code><span><span class="co">## Warning: glm.fit: fitted probabilities numerically 0 or 1 occurred</span></span></code></pre>
</div>
<div class="section level2">
<h2 id="globally-disabling-cache">Globally disabling cache<a class="anchor" aria-label="anchor" href="#globally-disabling-cache"></a>
</h2>
<p>You might want to cache interim results while developing (for speed)
and disable the cache completely during final analysis.</p>
<div class="sourceCode" id="cb29"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">oldopt</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/options.html" class="external-link">options</a></span><span class="op">(</span>cache.disable <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span></span>
<span><span class="va">fit</span> <span class="op">=</span> <span class="fu"><a href="../../reference/cached.html">cached</a></span><span class="op">(</span><span class="op">{</span></span>
<span>  <span class="va">expensiveDiamonds</span> <span class="op">=</span> <span class="va">diamonds</span> <span class="op"><a href="../../reference/pipe.html">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>expensive <span class="op">=</span> <span class="va">price</span><span class="op">&gt;</span><span class="fu"><a href="https://rdrr.io/r/stats/quantile.html" class="external-link">quantile</a></span><span class="op">(</span><span class="va">price</span>,<span class="va">quantCutOff</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/stats/glm.html" class="external-link">glm</a></span><span class="op">(</span><span class="va">expensive</span> <span class="op">~</span> <span class="va">carat</span><span class="op">+</span><span class="va">cut</span><span class="op">+</span><span class="va">color</span><span class="op">+</span><span class="va">clarity</span><span class="op">+</span><span class="va">depth</span><span class="op">+</span><span class="va">table</span>, family <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/family.html" class="external-link">binomial</a></span><span class="op">(</span>link<span class="op">=</span><span class="st">'logit'</span><span class="op">)</span>, data<span class="op">=</span><span class="va">expensiveDiamonds</span> <span class="op">)</span></span>
<span><span class="op">}</span>, <span class="va">diamonds</span>, <span class="va">quantCutOff</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## caching item: /tmp/RtmpZBelAG/cached-4d33d39f25b44f2dd0e3f1c284e46470-c6e03ac8f53dbecd19a32787db92df7a.rda</span></span></code></pre>
<pre><code><span><span class="co">## Warning: glm.fit: fitted probabilities numerically 0 or 1 occurred</span></span></code></pre>
<div class="sourceCode" id="cb32"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/options.html" class="external-link">options</a></span><span class="op">(</span><span class="va">oldopt</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="manually-removing-items-from-cache">Manually removing items from cache<a class="anchor" aria-label="anchor" href="#manually-removing-items-from-cache"></a>
</h2>
<p>In general items can be left in the cache, and they will get removed
when it is determined that they are stale. A manual flush of the cache
can be done like this. Usually the interactive option will be omitted if
run at the command line</p>
<div class="sourceCode" id="cb33"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../../reference/cache_clear.html">cache_clear</a></span><span class="op">(</span>interactive <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="caching-multiple-types-of-data">Caching multiple types of data<a class="anchor" aria-label="anchor" href="#caching-multiple-types-of-data"></a>
</h2>
<p>Controlling the naming of the cache items helps to keep track of the
items in the cache if you are manually inspecting it. If the items
follow a naming convention then deleting items from the cache can then
be done on a type by type basis.</p>
<div class="sourceCode" id="cb34"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">fit</span> <span class="op">=</span> <span class="fu"><a href="../../reference/cached.html">cached</a></span><span class="op">(</span><span class="op">{</span></span>
<span>  <span class="va">expensiveDiamonds</span> <span class="op">=</span> <span class="va">diamonds</span> <span class="op"><a href="../../reference/pipe.html">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>expensive <span class="op">=</span> <span class="va">price</span><span class="op">&gt;</span><span class="fu"><a href="https://rdrr.io/r/stats/quantile.html" class="external-link">quantile</a></span><span class="op">(</span><span class="va">price</span>,<span class="va">quantCutOff</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/stats/glm.html" class="external-link">glm</a></span><span class="op">(</span><span class="va">expensive</span> <span class="op">~</span> <span class="va">carat</span><span class="op">+</span><span class="va">cut</span><span class="op">+</span><span class="va">color</span><span class="op">+</span><span class="va">clarity</span><span class="op">+</span><span class="va">depth</span><span class="op">+</span><span class="va">table</span>, family <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/family.html" class="external-link">binomial</a></span><span class="op">(</span>link<span class="op">=</span><span class="st">'logit'</span><span class="op">)</span>, data<span class="op">=</span><span class="va">expensiveDiamonds</span> <span class="op">)</span></span>
<span><span class="op">}</span>, <span class="va">diamonds</span>, <span class="va">quantCutOff</span>, .prefix <span class="op">=</span> <span class="st">"diamonds"</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## caching item: /tmp/RtmpZBelAG/diamonds-4d33d39f25b44f2dd0e3f1c284e46470-c6e03ac8f53dbecd19a32787db92df7a.rda</span></span></code></pre>
<pre><code><span><span class="co">## Warning: glm.fit: fitted probabilities numerically 0 or 1 occurred</span></span></code></pre>
<div class="sourceCode" id="cb37"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">fit2</span> <span class="op">=</span> <span class="fu"><a href="../../reference/cached.html">cached</a></span><span class="op">(</span><span class="op">{</span></span>
<span>  <span class="va">fastCars</span> <span class="op">=</span> <span class="va">mtcars</span> <span class="op"><a href="../../reference/pipe.html">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>fast <span class="op">=</span> <span class="va">hp</span><span class="op">&gt;</span><span class="fu"><a href="https://rdrr.io/r/stats/quantile.html" class="external-link">quantile</a></span><span class="op">(</span><span class="va">hp</span>,<span class="va">quantCutOff</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/stats/glm.html" class="external-link">glm</a></span><span class="op">(</span><span class="va">fast</span> <span class="op">~</span> <span class="va">mpg</span><span class="op">+</span><span class="va">cyl</span><span class="op">+</span><span class="va">disp</span><span class="op">+</span><span class="va">drat</span><span class="op">+</span><span class="va">wt</span><span class="op">+</span><span class="va">gear</span>, family <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/family.html" class="external-link">binomial</a></span><span class="op">(</span>link<span class="op">=</span><span class="st">'logit'</span><span class="op">)</span>, data<span class="op">=</span><span class="va">fastCars</span> <span class="op">)</span></span>
<span><span class="op">}</span>, <span class="va">mtcars</span>, <span class="va">quantCutOff</span>, .prefix <span class="op">=</span> <span class="st">"cars"</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## caching item: /tmp/RtmpZBelAG/cars-4d33d39f25b44f2dd0e3f1c284e46470-d80edaedd01c0689a508e11d7fa6c365.rda</span></span></code></pre>
<pre><code><span><span class="co">## Warning: glm.fit: algorithm did not converge</span></span>
<span><span class="co">## Warning: glm.fit: fitted probabilities numerically 0 or 1 occurred</span></span></code></pre>
<div class="sourceCode" id="cb40"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../../reference/cache_clear.html">cache_clear</a></span><span class="op">(</span>.prefix <span class="op">=</span> <span class="st">"cars"</span>, interactive <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="../../reference/cache_clear.html">cache_clear</a></span><span class="op">(</span>.prefix <span class="op">=</span> <span class="st">"diamonds"</span>, interactive <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="caching-data-in-multiple-stages-of-analysis">Caching data in multiple stages of analysis<a class="anchor" aria-label="anchor" href="#caching-data-in-multiple-stages-of-analysis"></a>
</h2>
<p>One use of this is to allow analysis to be cached in stages, and
deleting cached content for unsuccessful stages.</p>
<p>N.b. as cache_clear uses regex it is probably best to avoid full stop
characters in the prefix.</p>
<div class="sourceCode" id="cb41"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">oldopts</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/options.html" class="external-link">options</a></span><span class="op">(</span>cache.item.prefix <span class="op">=</span> <span class="st">"stage-1"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">fit</span> <span class="op">=</span> <span class="fu"><a href="../../reference/cached.html">cached</a></span><span class="op">(</span><span class="op">{</span></span>
<span>  <span class="va">expensiveDiamonds</span> <span class="op">=</span> <span class="va">diamonds</span> <span class="op"><a href="../../reference/pipe.html">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>expensive <span class="op">=</span> <span class="va">price</span><span class="op">&gt;</span><span class="fu"><a href="https://rdrr.io/r/stats/quantile.html" class="external-link">quantile</a></span><span class="op">(</span><span class="va">price</span>,<span class="va">quantCutOff</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/stats/glm.html" class="external-link">glm</a></span><span class="op">(</span><span class="va">expensive</span> <span class="op">~</span> <span class="va">carat</span><span class="op">+</span><span class="va">cut</span><span class="op">+</span><span class="va">color</span><span class="op">+</span><span class="va">clarity</span><span class="op">+</span><span class="va">depth</span><span class="op">+</span><span class="va">table</span>, family <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/family.html" class="external-link">binomial</a></span><span class="op">(</span>link<span class="op">=</span><span class="st">'logit'</span><span class="op">)</span>, data<span class="op">=</span><span class="va">expensiveDiamonds</span> <span class="op">)</span></span>
<span><span class="op">}</span>, <span class="va">diamonds</span>, <span class="va">quantCutOff</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## caching item: /tmp/RtmpZBelAG/stage-1-4d33d39f25b44f2dd0e3f1c284e46470-c6e03ac8f53dbecd19a32787db92df7a.rda</span></span></code></pre>
<pre><code><span><span class="co">## Warning: glm.fit: fitted probabilities numerically 0 or 1 occurred</span></span></code></pre>
<div class="sourceCode" id="cb44"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/options.html" class="external-link">options</a></span><span class="op">(</span>cache.item.prefix <span class="op">=</span> <span class="st">"stage-2"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">fit2</span> <span class="op">=</span> <span class="fu"><a href="../../reference/cached.html">cached</a></span><span class="op">(</span><span class="op">{</span></span>
<span>  <span class="va">fastCars</span> <span class="op">=</span> <span class="va">mtcars</span> <span class="op"><a href="../../reference/pipe.html">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>fast <span class="op">=</span> <span class="va">hp</span><span class="op">&gt;</span><span class="fu"><a href="https://rdrr.io/r/stats/quantile.html" class="external-link">quantile</a></span><span class="op">(</span><span class="va">hp</span>,<span class="va">quantCutOff</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/stats/glm.html" class="external-link">glm</a></span><span class="op">(</span><span class="va">fast</span> <span class="op">~</span> <span class="va">mpg</span><span class="op">+</span><span class="va">cyl</span><span class="op">+</span><span class="va">disp</span><span class="op">+</span><span class="va">drat</span><span class="op">+</span><span class="va">wt</span><span class="op">+</span><span class="va">gear</span>, family <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/family.html" class="external-link">binomial</a></span><span class="op">(</span>link<span class="op">=</span><span class="st">'logit'</span><span class="op">)</span>, data<span class="op">=</span><span class="va">fastCars</span> <span class="op">)</span></span>
<span><span class="op">}</span>, <span class="va">mtcars</span>, <span class="va">quantCutOff</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## caching item: /tmp/RtmpZBelAG/stage-2-4d33d39f25b44f2dd0e3f1c284e46470-d80edaedd01c0689a508e11d7fa6c365.rda</span></span></code></pre>
<pre><code><span><span class="co">## Warning: glm.fit: algorithm did not converge</span></span>
<span><span class="co">## Warning: glm.fit: fitted probabilities numerically 0 or 1 occurred</span></span></code></pre>
<div class="sourceCode" id="cb47"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../../reference/cache_clear.html">cache_clear</a></span><span class="op">(</span>.prefix <span class="op">=</span> <span class="st">"stage-1"</span>, interactive <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span><span class="fu"><a href="../../reference/cache_clear.html">cache_clear</a></span><span class="op">(</span>.prefix <span class="op">=</span> <span class="st">"stage-2"</span>, interactive <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/options.html" class="external-link">options</a></span><span class="op">(</span><span class="va">oldopts</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="caching-a-url-download">Caching a url download<a class="anchor" aria-label="anchor" href="#caching-a-url-download"></a>
</h2>
<p>Getting a file from the internet and locally caching. This does not
check for remote changes. as before forcing the re-download can be
achieved with .nocache.</p>
<div class="sourceCode" id="cb48"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">file</span> <span class="op">=</span> <span class="fu"><a href="../../reference/cache_download.html">cache_download</a></span><span class="op">(</span></span>
<span>  <span class="st">"https://raw.githubusercontent.com/terminological/arear/main/data-raw/NHSSurgeCapacityMarch2020.csv"</span>,</span>
<span>  .extn <span class="op">=</span> <span class="st">"csv"</span>,</span>
<span>  .nocache <span class="op">=</span> <span class="cn">TRUE</span></span>
<span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## downloading item: NHSSurgeCapacityMarch2020.csv</span></span></code></pre>
</div>
<div class="section level2">
<h2 id="downloading-changing-data">Downloading changing data<a class="anchor" aria-label="anchor" href="#downloading-changing-data"></a>
</h2>
<p>If you want a daily download setting the .stale parameter to one day
will download the data at most once per day. Staleness is determined by
the number of days from 2am on the current day in the current time-zone.
A item cached for only one day becomes stale at 2am the day after it is
cached. The time is configurable and for example
<code>option(cache.time_day_starts = 0)</code> would set this to be
midnight. Automated analysis using caches and updated data should ensure
that analysis does not run over this time point otherwise it may end up
unexpectedly using old data.</p>
<div class="sourceCode" id="cb50"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># number of days before reloading</span></span>
<span><span class="va">file</span> <span class="op">=</span> <span class="fu"><a href="../../reference/cache_download.html">cache_download</a></span><span class="op">(</span></span>
<span>  <span class="st">"https://raw.githubusercontent.com/terminological/arear/main/data-raw/NHSSurgeCapacityMarch2020.csv"</span>,</span>
<span>  .stale <span class="op">=</span> <span class="fl">1</span>,</span>
<span>  .extn <span class="op">=</span> <span class="st">"csv"</span></span>
<span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## downloading item: NHSSurgeCapacityMarch2020.csv</span></span></code></pre>
</div>
  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Robert Challen.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.9.</p>
</div>

    </footer>
</div>

  

  

  </body>
</html>
